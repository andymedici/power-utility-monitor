{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1><i class="bi bi-graph-up"></i> Monitoring Status</h1>
        <p class="text-muted">System health and data source monitoring</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center border-success">
            <div class="card-body">
                <h5 class="text-success">System Status</h5>
                <h2><i class="bi bi-check-circle-fill text-success"></i></h2>
                <p>Operational</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5>Sources Active</h5>
                <h2>{{ source_stats|length }}</h2>
                <p>Data Sources</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5>Last Run</h5>
                <h2>{% if runs %}{{ runs[0].run_date.strftime('%H:%M') }}{% else %}--:--{% endif %}</h2>
                <p>{% if runs %}{{ runs[0].run_date.strftime('%Y-%m-%d') }}{% else %}No runs yet{% endif %}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5>Monthly Cost</h5>
                <h2 class="text-success">$0</h2>
                <p>Free Sources Only</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <h5><i class="bi bi-clock-history"></i> Recent Monitoring Runs</h5>
                <form action="{{ url_for('run_monitor') }}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="bi bi-play-fill"></i> Run Now
                    </button>
                </form>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Status</th>
                                <th>Sources</th>
                                <th>Found</th>
                                <th>Stored</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for run in runs %}
                            <tr>
                                <td>{{ run.run_date.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td><span class="badge bg-success">{{ run.status|title }}</span></td>
                                <td>{{ run.sources_checked or 0 }}</td>
                                <td>{{ run.requests_found or 0 }}</td>
                                <td>
                                    {% if run.requests_stored > 0 %}
                                        <strong class="text-success">{{ run.requests_stored }}</strong>
                                    {% else %}
                                        {{ run.requests_stored or 0 }}
                                    {% endif %}
                                </td>
                                <td>{{ "%.1f"|format(run.duration_seconds or 0) }}s</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if not runs %}
                <div class="text-center py-4">
                    <i class="bi bi-clock display-4 text-muted"></i>
                    <p class="mt-2 text-muted">No monitoring runs yet. Click "Run Now" to start.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}