{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card bg-hunter border-0 shadow">
            <div class="card-body p-4">
                <h1 class="display-5 fw-bold">Market Intelligence</h1>
                <p class="lead">Scanning 5 ISOs for stealth high-load interconnection requests.</p>
                <form action="/trigger" method="POST">
                    <button class="btn btn-light fw-bold">ðŸ”„ Run Manual Scan</button>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <h6 class="text-muted text-uppercase">Suspected Data Centers</h6>
                <h2 class="display-4 fw-bold text-danger">{{ suspected_dc }}</h2>
                <small>Out of {{ total }} active projects</small>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ðŸŽ¯ Top Priority Targets</h5>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Confidence</th>
                            <th>Project / Customer</th>
                            <th>Load</th>
                            <th>Location</th>
                            <th>Signals</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in top_hunters %}
                        <tr>
                            <td>
                                <span class="badge {% if p.hunter_score > 70 %}bg-danger{% elif p.hunter_score > 40 %}bg-warning text-dark{% else %}bg-success{% endif %}">
                                    {{ p.hunter_score }}%
                                </span>
                            </td>
                            <td>
                                <strong>{{ p.project_name }}</strong><br>
                                <small class="text-muted">{{ p.customer }}</small>
                            </td>
                            <td>{{ "%.0f"|format(p.capacity_mw) }} MW</td>
                            <td>{{ p.county }}, {{ p.state }}</td>
                            <td><small>{{ p.hunter_notes }}</small></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ðŸ“¡ System Status</h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for log in logs %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ log.iso }}</strong><br>
                        <small class="text-muted">{{ log.run_date.strftime('%H:%M %p') }}</small>
                    </div>
                    <div class="text-end">
                        {% if log.status == 'Success' %}
                        <span class="badge bg-success rounded-pill">{{ log.projects_found }} items</span>
                        {% else %}
                        <span class="badge bg-danger rounded-pill">Failed</span>
                        {% endif %}
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
